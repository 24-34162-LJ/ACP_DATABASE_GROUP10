{% extends "base.html" %}
{% block title %}My Favorites{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='favorites/favorites.css') }}">
{% endblock %}

{% block content %}

<div class="favorites-wrap">

    <h2>My Favorite Terminals & Routes</h2>

    <p>
        <a class="back-link" href="{{ url_for('map_view') }}">⬅ Back to Map</a>
    </p>

    {% if favorites %}
    <div class="favorites-card">
        <table class="fav-table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Name</th>
                    <th>Details</th>
                    <th>My Label</th>
                    <th>Saved On</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody>
                {% for f in favorites %}
                <tr>

                    {# TYPE #}
                    <td data-label="Type">
                        {% if f.favorite_route_fk %}
                            <span class="type-pill">Route</span>
                        {% elif f.favorite_terminal_fk %}
                            <span class="type-pill">Terminal</span>
                        {% else %}
                            <span class="type-pill">Unknown</span>
                        {% endif %}
                    </td>

                    {# NAME #}
                    <td data-label="Name">
                        {% if f.favorite_route_fk %}
                            {{ f.favorite_route_fk.route_name }}
                        {% elif f.favorite_terminal_fk %}
                            {{ f.favorite_terminal_fk.terminal_name }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    {# DETAILS #}
                    <td data-label="Details">
                        {% if f.favorite_route_fk %}
                            From {{ f.favorite_route_fk.start_terminal.terminal_name }}
                            → {{ f.favorite_route_fk.end_terminal.terminal_name }}
                        {% elif f.favorite_terminal_fk %}
                            {{ f.favorite_terminal_fk.location }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    {# LABEL #}
                    <td data-label="My Label">
                        <form method="post"
                              action="{{ url_for('update_favorite_label', favorite_id=f.favorite_id) }}">
                            <input type="text" name="label" value="{{ f.label or '' }}"
                                   placeholder="Add a note (optional)">
                            <button type="submit">Save</button>
                        </form>
                    </td>

                    {# DATE #}
                    <td data-label="Saved On">
                        {% if f.date_created %}
                            <span class="date">{{ f.date_created.strftime("%Y-%m-%d %H:%M") }}</span>
                        {% else %}
                            –
                        {% endif %}
                    </td>

                    {# DELETE #}
                    <td data-label="Actions">
                        <form method="post"
                              action="{{ url_for('remove_favorite') }}"
                              onsubmit="return confirm('Remove this from favorites?');">

                            {% if f.terminal_id %}
                                <input type="hidden" name="terminal_id" value="{{ f.terminal_id }}">
                            {% endif %}
                            {% if f.route_id %}
                                <input type="hidden" name="route_id" value="{{ f.route_id }}">
                            {% endif %}

                            <button class="delete-btn" type="submit">Delete</button>
                        </form>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
        <p class="muted">No favorites yet. Go to the map and click ⭐ <b>Save</b> on a terminal or route.</p>
    {% endif %}

</div>

{% endblock %}
